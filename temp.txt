// ====== Node Screenshot ======
Thread.sleep(5000);
File NsrcFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
File NdestFile = new File(
    System.getProperty("user.dir") + "/src/test/java/Results/NodeStatus_" + timestp + ".jpg"
);
NdestFile.getParentFile().mkdirs();
FileUtils.copyFile(NsrcFile, NdestFile);

// ====== Troubleshoot ======
WebElement Tshoot = wait.until(ExpectedConditions.elementToBeClickable(
    By.xpath("//a[contains(text(),'Troubleshoot')]")
));
Tshoot.click();
Thread.sleep(3000);

// Switch into frame
driver.switchTo().frame("basefrm");

// ====== DB Usage ======
WebElement DbUsage = wait.until(ExpectedConditions.elementToBeClickable(
    By.xpath("//a[contains(text(),'DB Usage')]")
));
DbUsage.click();

// Handle alert
Thread.sleep(3000);
Alert alert = driver.switchTo().alert();
alert.accept();

// Switch to the new tab (always last one)
ArrayList<String> tabs2 = new ArrayList<>(driver.getWindowHandles());
driver.switchTo().window(tabs2.get(tabs2.size() - 1));

File DNsrcFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
File DNdestFile = new File(
    System.getProperty("user.dir") + "/src/test/java/Results/DBUsage_" + timestp + ".jpg"
);
DNdestFile.getParentFile().mkdirs();
FileUtils.copyFile(DNsrcFile, DNdestFile);

driver.close();  // close DBUsage tab

// Back to dashboard tab
driver.switchTo().window(tabs.get(1));

// ====== Business Usage ======
// Important: reset to defaultContent if youâ€™re still in a frame
driver.switchTo().defaultContent();

WebElement BUsage = wait.until(ExpectedConditions.elementToBeClickable(
    By.xpath("//a[contains(text(),'Business Usage')]")
));
BUsage.click();

// Switch to last tab (Business Usage opens in new tab)
ArrayList<String> tabs3 = new ArrayList<>(driver.getWindowHandles());
driver.switchTo().window(tabs3.get(tabs3.size() - 1));

Thread.sleep(3000);
File BUsrcFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
File BUdestFile = new File(
    System.getProperty("user.dir") + "/src/test/java/Results/BusinessUsage_" + timestp + ".jpg"
);
BUdestFile.getParentFile().mkdirs();
FileUtils.copyFile(BUsrcFile, BUdestFile);
